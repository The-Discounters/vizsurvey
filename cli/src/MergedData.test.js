import { jest } from "@jest/globals";
import { MergedData } from "./MergedData.js";
import { createStat, updateStats, clearStats } from "./stats.js";
import { drawStatus } from "./monitorUtil";

describe("MergedData test ", () => {
  it("Test addEntry single object creates the union of properties of different entries for the same participant.", (done) => {
    const md = new MergedData();
    md.addEntry([{ participantId: "1", property1: "value1" }]);
    md.addEntry([{ participantId: "1", property2: "value2" }]);
    function callback(value, key) {
      try {
        expect(key).toBe("1");
        expect(value).toStrictEqual({
          age: "",
          amountEarlier_1: "",
          amountEarlier_2: "",
          amountEarlier_3: "",
          amountEarlier_4: "",
          amountEarlier_5: "",
          amountEarlier_6: "",
          amountEarlier_7: "",
          amountEarlier_8: "",
          amountLater_1: "",
          amountLater_2: "",
          amountLater_3: "",
          amountLater_4: "",
          amountLater_5: "",
          amountLater_6: "",
          amountLater_7: "",
          amountLater_8: "",
          attentionCheck: "",
          attentionCheckCompletedTimestamp: "",
          attentionCheckShownTimestamp: "",
          attentionCheckTimeSec: "",
          bottomMarginHeightIn_1: "",
          bottomMarginHeightIn_2: "",
          bottomMarginHeightIn_3: "",
          bottomMarginHeightIn_4: "",
          bottomMarginHeightIn_5: "",
          bottomMarginHeightIn_6: "",
          bottomMarginHeightIn_7: "",
          bottomMarginHeightIn_8: "",
          choiceTimeSec_1: "",
          choiceTimeSec_2: "",
          choiceTimeSec_3: "",
          choiceTimeSec_4: "",
          choiceTimeSec_5: "",
          choiceTimeSec_6: "",
          choiceTimeSec_7: "",
          choiceTimeSec_8: "",
          choiceTimestamp_1: "",
          choiceTimestamp_2: "",
          choiceTimestamp_3: "",
          choiceTimestamp_4: "",
          choiceTimestamp_5: "",
          choiceTimestamp_6: "",
          choiceTimestamp_7: "",
          choiceTimestamp_8: "",
          choice_1: "",
          choice_2: "",
          choice_3: "",
          choice_4: "",
          choice_5: "",
          choice_6: "",
          choice_7: "",
          choice_8: "",
          consentChecked: "",
          consentCompletedTimestamp: "",
          consentShownTimestamp: "",
          consentTimeSec: "",
          countryOfResidence: "",
          dateEarlier_1: "",
          dateEarlier_2: "",
          dateEarlier_3: "",
          dateEarlier_4: "",
          dateEarlier_5: "",
          dateEarlier_6: "",
          dateEarlier_7: "",
          dateEarlier_8: "",
          dateLater_1: "",
          dateLater_2: "",
          dateLater_3: "",
          dateLater_4: "",
          dateLater_5: "",
          dateLater_6: "",
          dateLater_7: "",
          dateLater_8: "",
          debriefCompletedTimestamp: "",
          debriefShownTimestamp: "",
          debriefTimeSec: "",
          demographicCompletedTimestamp: "",
          demographicShownTimestamp: "",
          demographicTimeSec: "",
          discountLitSurveyQuestionsCompletedTimestamp: "",
          discountLitSurveyQuestionsShownTimestamp: "",
          discountLitSurveyTimeSec: "",
          dragAmount_1: "",
          dragAmount_2: "",
          dragAmount_3: "",
          dragAmount_4: "",
          dragAmount_5: "",
          dragAmount_6: "",
          dragAmount_7: "",
          dragAmount_8: "",
          employment: "",
          experienceSurveyQuestionsCompletedTimestamp: "",
          experienceSurveyQuestionsShownTimestamp: "",
          experienceSurveyTimeSec: "",
          experience_survey_clear: "",
          experience_survey_easy: "",
          experience_survey_enjoy: "",
          experience_survey_format: "",
          experience_survey_imagine: "",
          experience_survey_mental: "",
          experience_survey_present: "",
          experience_survey_understand: "",
          feedback: "",
          financialLitSurveyQuestionsCompletedTimestamp: "",
          financialLitSurveyQuestionsShownTimestamp: "",
          financialLitSurveyTimeSec: "",
          financial_lit_survey_inflation: "",
          financial_lit_survey_numeracy: "",
          financial_lit_survey_risk: "",
          gender: "",
          graphHeightIn_1: "",
          graphHeightIn_2: "",
          graphHeightIn_3: "",
          graphHeightIn_4: "",
          graphHeightIn_5: "",
          graphHeightIn_6: "",
          graphHeightIn_7: "",
          graphHeightIn_8: "",
          graphWidthIn_1: "",
          graphWidthIn_2: "",
          graphWidthIn_3: "",
          graphWidthIn_4: "",
          graphWidthIn_5: "",
          graphWidthIn_6: "",
          graphWidthIn_7: "",
          graphWidthIn_8: "",
          heightIn_1: "",
          heightIn_2: "",
          heightIn_3: "",
          heightIn_4: "",
          heightIn_5: "",
          heightIn_6: "",
          heightIn_7: "",
          heightIn_8: "",
          highup_1: "",
          highup_2: "",
          highup_3: "",
          highup_4: "",
          highup_5: "",
          highup_6: "",
          highup_7: "",
          highup_8: "",
          horizontalPixels_1: "",
          horizontalPixels_2: "",
          horizontalPixels_3: "",
          horizontalPixels_4: "",
          horizontalPixels_5: "",
          horizontalPixels_6: "",
          horizontalPixels_7: "",
          horizontalPixels_8: "",
          instructionsCompletedTimestamp: "",
          instructionsShownTimestamp: "",
          instructionsTimeSec: "",
          interaction_1: "",
          interaction_2: "",
          interaction_3: "",
          interaction_4: "",
          interaction_5: "",
          interaction_6: "",
          interaction_7: "",
          interaction_8: "",
          introductionCompletedTimestamp: "",
          introductionShownTimestamp: "",
          introductionTimeSec: "",
          leftMarginWidthIn_1: "",
          leftMarginWidthIn_2: "",
          leftMarginWidthIn_3: "",
          leftMarginWidthIn_4: "",
          leftMarginWidthIn_5: "",
          leftMarginWidthIn_6: "",
          leftMarginWidthIn_7: "",
          leftMarginWidthIn_8: "",
          lowdown_1: "",
          lowdown_2: "",
          lowdown_3: "",
          lowdown_4: "",
          lowdown_5: "",
          lowdown_6: "",
          lowdown_7: "",
          lowdown_8: "",
          maxAmount_1: "",
          maxAmount_2: "",
          maxAmount_3: "",
          maxAmount_4: "",
          maxAmount_5: "",
          maxAmount_6: "",
          maxAmount_7: "",
          maxAmount_8: "",
          maxTime_1: "",
          maxTime_2: "",
          maxTime_3: "",
          maxTime_4: "",
          maxTime_5: "",
          maxTime_6: "",
          maxTime_7: "",
          maxTime_8: "",
          participantId: "1",
          position_1: "",
          position_2: "",
          position_3: "",
          position_4: "",
          position_5: "",
          position_6: "",
          position_7: "",
          position_8: "",
          profession: "",
          property1: "value1",
          property2: "value2",
          purposeSurveyQuestionsCompletedTimestamp: "",
          purposeSurveyQuestionsShownTimestamp: "",
          purposeSurveyTimeSec: "",
          purpose_survey_better: "",
          purpose_survey_describe: "",
          purpose_survey_difference: "",
          purpose_survey_effort: "",
          purpose_survey_serve: "",
          purpose_survey_truly: "",
          screenAvailHeight: "",
          screenAvailWidth: "",
          screenColorDepth: "",
          screenHeight: "",
          screenOrientationAngle: "",
          screenOrientationType: "",
          screenPixelDepth: "",
          screenWidth: "",
          selfDescribeEmployment: "",
          selfDescribeGender: "",
          sessionId: "",
          showMinorTicks_1: "",
          showMinorTicks_2: "",
          showMinorTicks_3: "",
          showMinorTicks_4: "",
          showMinorTicks_5: "",
          showMinorTicks_6: "",
          showMinorTicks_7: "",
          showMinorTicks_8: "",
          shownTimestamp_1: "",
          shownTimestamp_2: "",
          shownTimestamp_3: "",
          shownTimestamp_4: "",
          shownTimestamp_5: "",
          shownTimestamp_6: "",
          shownTimestamp_7: "",
          shownTimestamp_8: "",
          studyId: "",
          theEndCompletedTimestamp: "",
          theEndShownTimestamp: "",
          theEndTimeSec: "",
          timeEarlier_1: "",
          timeEarlier_2: "",
          timeEarlier_3: "",
          timeEarlier_4: "",
          timeEarlier_5: "",
          timeEarlier_6: "",
          timeEarlier_7: "",
          timeEarlier_8: "",
          timeLater_1: "",
          timeLater_2: "",
          timeLater_3: "",
          timeLater_4: "",
          timeLater_5: "",
          timeLater_6: "",
          timeLater_7: "",
          timeLater_8: "",
          timezone: "",
          treatmentId: "",
          userAgent: "",
          variableAmount_1: "",
          variableAmount_2: "",
          variableAmount_3: "",
          variableAmount_4: "",
          variableAmount_5: "",
          variableAmount_6: "",
          variableAmount_7: "",
          variableAmount_8: "",
          verticalPixels_1: "",
          verticalPixels_2: "",
          verticalPixels_3: "",
          verticalPixels_4: "",
          verticalPixels_5: "",
          verticalPixels_6: "",
          verticalPixels_7: "",
          verticalPixels_8: "",
          viewType_1: "",
          viewType_2: "",
          viewType_3: "",
          viewType_4: "",
          viewType_5: "",
          viewType_6: "",
          viewType_7: "",
          viewType_8: "",
          vizFamiliarity: "",
          widthIn_1: "",
          widthIn_2: "",
          widthIn_3: "",
          widthIn_4: "",
          widthIn_5: "",
          widthIn_6: "",
          widthIn_7: "",
          widthIn_8: "",
          windowDevicePixelRatio: "",
          windowInnerHeight: "",
          windowInnerWidth: "",
          windowOuterHeight: "",
          windowOuterWidth: "",
          windowScreenLeft: "",
          windowScreenTop: "",
        });
        done();
      } catch (error) {
        done(error);
      }
    }
    md.callForEntry(callback);
  });
  it("Test stats for single treatment in progress counters.", () => {
    createStat(1);
    const stats = updateStats({
      treatment_id: 1,
      country_of_residence: "usa",
      consent_completed_timestamp: null,
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: null,
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: null,
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: null,
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: null,
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: null,
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp: null,
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp: null,
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp: null,
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: null,
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: null,
    });
    expect(stats).toStrictEqual({
      surveysComplete: [0],
      surveysInProgress: [1],
      countryUSA: 1,
      countryOther: 0,
      consentInProgress: [1],
      consentComplete: [0],
      demographicsInProgress: [1],
      demographicsComplete: [0],
      introductionInProgress: [1],
      introductionComplete: [0],
      instructionsInProgress: [1],
      instructionsComplete: [0],
      choicesInProgress: [1],
      choicesComplete: [0],
      experienceInProgress: [1],
      attentionCheckCompleted: [0],
      attentionCheckInProgress: [1],
      experienceComplete: [0],
      financialInProgress: [1],
      financialComplete: [0],
      purposeInProgress: [1],
      purposeComplete: [0],
      debriefInProgress: [1],
      debriefComplete: [0],
      feedback: [[]],
    });
  });
  it("Test stats for single treatment completed counters.", () => {
    createStat(1);
    const stats = updateStats({
      treatment_id: 1,
      country_of_residence: "gbr",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 1",
    });
    const statsJSON = JSON.stringify(stats);
    expect(statsJSON).toBe(
      '{"surveysComplete":[1],"surveysInProgress":[0],"countryUSA":0,"countryOther":1,"consentInProgress":[0],"consentComplete":[1],"demographicsInProgress":[0],"demographicsComplete":[1],"introductionInProgress":[0],"introductionComplete":[1],"instructionsInProgress":[0],"instructionsComplete":[1],"choicesInProgress":[0],"choicesComplete":[1],"experienceInProgress":[0],"attentionCheckCompleted":[1],"attentionCheckInProgress":[0],"experienceComplete":[1],"financialInProgress":[0],"financialComplete":[1],"purposeInProgress":[0],"purposeComplete":[1],"debriefInProgress":[0],"debriefComplete":[1],"feedback":[[{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 1"}]]}'
    );
  });
  it("Test stats for two treatments completed counters.", () => {
    createStat(2);
    updateStats({
      treatment_id: 1,
      country_of_residence: "usa",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 1",
    });
    const stats = updateStats({
      treatment_id: 2,
      country_of_residence: "usa",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 2",
    });
    expect(JSON.stringify(stats)).toBe(
      '{"surveysComplete":[1,1],"surveysInProgress":[0,0],"countryUSA":2,"countryOther":0,"consentInProgress":[0,0],"consentComplete":[1,1],"demographicsInProgress":[0,0],"demographicsComplete":[1,1],"introductionInProgress":[0,0],"introductionComplete":[1,1],"instructionsInProgress":[0,0],"instructionsComplete":[1,1],"choicesInProgress":[0,0],"choicesComplete":[1,1],"experienceInProgress":[0,0],"attentionCheckCompleted":[1,1],"attentionCheckInProgress":[0,0],"experienceComplete":[1,1],"financialInProgress":[0,0],"financialComplete":[1,1],"purposeInProgress":[0,0],"purposeComplete":[1,1],"debriefInProgress":[0,0],"debriefComplete":[1,1],"feedback":[[{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 1"}],[{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 2"}]]}'
    );
  });
  it("Test stats for one treatments completed counters more than one CSV.", () => {
    createStat(2);
    updateStats({
      treatment_id: 1,
      country_of_residence: "usa",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 1",
    });
    const stats = updateStats({
      treatment_id: 1,
      country_of_residence: "usa",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 2",
    });
    expect(JSON.stringify(stats)).toBe(
      '{"surveysComplete":[2,0],"surveysInProgress":[0,0],"countryUSA":2,"countryOther":0,"consentInProgress":[0,0],"consentComplete":[2,0],"demographicsInProgress":[0,0],"demographicsComplete":[2,0],"introductionInProgress":[0,0],"introductionComplete":[2,0],"instructionsInProgress":[0,0],"instructionsComplete":[2,0],"choicesInProgress":[0,0],"choicesComplete":[2,0],"experienceInProgress":[0,0],"attentionCheckCompleted":[2,0],"attentionCheckInProgress":[0,0],"experienceComplete":[2,0],"financialInProgress":[0,0],"financialComplete":[2,0],"purposeInProgress":[0,0],"purposeComplete":[2,0],"debriefInProgress":[0,0],"debriefComplete":[2,0],"feedback":[[{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 1"},{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 2"}],[]]}'
    );
  });
  it("Test clear stats.", () => {
    createStat(2);
    updateStats({
      treatment_id: 1,
      country_of_residence: "usa",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 1",
    });
    const stats = updateStats({
      treatment_id: 2,
      country_of_residence: "usa",
      consent_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: "2023-01-17T18:16:07.371+00:00",
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: "feedback 2",
    });
    expect(JSON.stringify(stats)).toBe(
      '{"surveysComplete":[1,1],"surveysInProgress":[0,0],"countryUSA":2,"countryOther":0,"consentInProgress":[0,0],"consentComplete":[1,1],"demographicsInProgress":[0,0],"demographicsComplete":[1,1],"introductionInProgress":[0,0],"introductionComplete":[1,1],"instructionsInProgress":[0,0],"instructionsComplete":[1,1],"choicesInProgress":[0,0],"choicesComplete":[1,1],"experienceInProgress":[0,0],"attentionCheckCompleted":[1,1],"attentionCheckInProgress":[0,0],"experienceComplete":[1,1],"financialInProgress":[0,0],"financialComplete":[1,1],"purposeInProgress":[0,0],"purposeComplete":[1,1],"debriefInProgress":[0,0],"debriefComplete":[1,1],"feedback":[[{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 1"}],[{"date":"2023-01-17T18:16:07.371+00:00","feedback":"feedback 2"}]]}'
    );
    clearStats();
    expect(JSON.stringify(stats)).toBe(
      '{"surveysComplete":[0,0],"surveysInProgress":[0,0],"countryUSA":0,"countryOther":0,"consentInProgress":[0,0],"consentComplete":[0,0],"demographicsInProgress":[0,0],"demographicsComplete":[0,0],"introductionInProgress":[0,0],"introductionComplete":[0,0],"instructionsInProgress":[0,0],"instructionsComplete":[0,0],"choicesInProgress":[0,0],"choicesComplete":[0,0],"experienceInProgress":[0,0],"attentionCheckCompleted":[0,0],"attentionCheckInProgress":[0,0],"experienceComplete":[0,0],"financialInProgress":[0,0],"financialComplete":[0,0],"purposeInProgress":[0,0],"purposeComplete":[0,0],"debriefInProgress":[0,0],"debriefComplete":[0,0],"feedback":[[],[]]}'
    );
  });
  it("Test drawStatus.", () => {
    createStat(1);
    const stats = updateStats({
      treatment_id: 1,
      country_of_residence: "usa",
      consent_completed_timestamp: null,
      consent_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      demographic_completed_timestamp: null,
      demographic_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      introduction_completed_timestamp: null,
      introduction_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      instructions_completed_timestamp: null,
      instructions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      attention_check_completed_timestamp: null,
      attention_check_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      choice_timestamp_8: null,
      shown_timestamp_1: "2023-01-17T18:16:07.371+00:00",
      experience_survey_questions_completed_timestamp: null,
      experience_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      financial_lit_survey_questions_completed_timestamp: null,
      financial_lit_survey_questions_shown_timestamp:
        "2023-01-17T18:16:07.371+00:00",
      purpose_survey_questions_completed_timestamp: null,
      purpose_survey_questions_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      debrief_completed_timestamp: null,
      debrief_shown_timestamp: "2023-01-17T18:16:07.371+00:00",
      feedback: null,
    });
    const logSpy = jest.spyOn(global.console, "log");
    //drawStatus(150, stats, true, 10).output();
    expect(logSpy).toHaveBeenCalled();
    expect(logSpy).toHaveBeenCalledTimes(2);
    expect(logSpy).toHaveBeenCalledWith("");
    logSpy.mockRestore();
  });
});
